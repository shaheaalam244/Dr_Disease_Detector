# Dr. Disease Detector

A Streamlit app that offers AI-assisted chat with an "AI Doctor" and provides machine-learning-based predictions for Diabetes and Heart Disease.

## Features
- Interactive AI chat powered by Google Gemini (Gemini API key required)
- Diabetes and Heart Disease prediction panels using pre-trained scikit-learn models (pickle files)
- Text-to-speech (pyttsx3) to speak AI responses locally
- Friendly Streamlit UI with dark themed styling

## Repository structure

```
.
├── app.py                 # Main Streamlit app
├── module.py              # (optional) helper functions (if present)
├── models/                # Pickle files and datasets
│   ├── diabetes.csv
│   ├── diabetes project .ipynb
│   └── heart_model.pkl    # example expected model file name
├── requirements.txt       # Python dependencies
└── README.md
```

## Prerequisites
- macOS, Linux or Windows with Python 3.8+ (tested with 3.8–3.11)
- A virtual environment is strongly recommended
- Google Gemini API key (set as `GEMINI_API_KEY` in a `.env` file)
- Pre-trained model pickle files placed in the `models/` folder. The app expects:
  - `models/diabetes.pkl` containing either a pickled sklearn model or a dict with keys `model`, `scaler`, `accuracy`, `f1`.
  - `models/heart_model.pkl` containing either a pickled sklearn model or a dict with keys `model`, `scaler`, `accuracy`, `f1`.

If you don't have the pickle files, the app will error when attempting to load them. See "Creating the model files" below for instructions to create compatible files.

## Installation

1. Clone the repository (if not already):

```bash
git clone <repo-url> dr-disease-detector
cd dr-disease-detector
```

2. Create and activate a virtual environment (recommended):

```bash
python3 -m venv .venv
source .venv/bin/activate
```

3. Install dependencies:

```bash
pip install -r requirements.txt
```

4. Create a `.env` file in the project root and add your Gemini API key:

```bash
echo "GEMINI_API_KEY=your_api_key_here" > .env
```

Replace `your_api_key_here` with your actual Gemini API key. Without it, the app will display an error and stop.

## Running the app

Start the Streamlit app from the project root:

```bash
streamlit run app.py
```

Open the URL shown in the terminal (usually http://localhost:8501) to view the app.

## How the app works

- On load, the app checks for `GEMINI_API_KEY` in the environment using `python-dotenv`.
- The left sidebar contains a toggle to switch between chat mode and prediction mode.
- Chat mode: you can enter health-related questions; responses are generated by the Gemini model and can be played back with local TTS using `pyttsx3`.
- Prediction mode: two expanders allow filling inputs for Diabetes and Heart Disease. When you click predict, the app loads a pickle model from `models/` and runs `predict()`.

Model expectations
- The `load_model` helper in `app.py` attempts to open `models/<model_name>.pkl`. It accepts two shapes:
  1. A plain trained sklearn model object.
  2. A dict with keys `model`, `scaler`, `accuracy`, `f1` where `model` is the sklearn estimator and `scaler` is a fitted scaler (optional).

If your model requires scaling, include the scaler in the dict so the app can call `scaler.transform()` before prediction.

## Creating compatible model pickle files (quick guide)

This repository doesn't include training code by default. Here's a minimal example to train and save a model compatible with the app.

1. Example training script (save as `train_save_example.py`):

```python
import pickle
from sklearn.ensemble import RandomForestClassifier
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split
import pandas as pd

# Load dataset
df = pd.read_csv('models/diabetes.csv')
X = df.drop('Outcome', axis=1)
y = df['Outcome']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
scaler = StandardScaler().fit(X_train)
X_train_scaled = scaler.transform(X_train)

model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train_scaled, y_train)

acc = model.score(scaler.transform(X_test), y_test)
from sklearn.metrics import f1_score
f1 = f1_score(y_test, model.predict(scaler.transform(X_test)))

payload = {"model": model, "scaler": scaler, "accuracy": acc, "f1": f1}
with open('models/diabetes.pkl', 'wb') as f:
    pickle.dump(payload, f)

print('Saved models/diabetes.pkl')
```

2. Run the script to produce `models/diabetes.pkl`:

```bash
python train_save_example.py
```

Repeat the process for `heart_model.pkl` using an appropriate dataset (e.g., `heart_disease.csv`) and adjust column names.

## Troubleshooting

- If you see "GEMINI_API_KEY not found in .env file": ensure `.env` exists and contains `GEMINI_API_KEY` and that you restarted the Streamlit app after creating `.env`.
- If model loading fails: check that the expected pickle files exist in `models/` and follow the model payload shape described earlier.
- If TTS (pyttsx3) fails: ensure your system audio is configured. On some platforms `pyttsx3` needs additional system drivers.
- If the Gemini API returns errors or the model stream is slow: check API key validity, rate limits, and network connectivity.

## Developer notes

- The app uses `st.cache_resource` to cache loaded models. If you update a model file and Streamlit still uses the old copy, restart the Streamlit server.
- The AI chat uses `google.genai`'s streaming API. You can change `model="gemini-2.5-flash"` to another deployed Gemini model if you have access.

## Security & privacy

- This app sends user messages to the configured Gemini model. Do not use production patient data without proper consent and compliance.

## Contributing

- Feel free to open issues or PRs to improve model training scripts, add unit tests, or add Docker support.

## License

- This project does not include a license file. Add one if you plan to publish or share the project.

---

If you'd like, I can also:
- Add a `train.py` script to train and save models used by the app.
- Add a `requirements.txt` review and pin versions.
- Add a Dockerfile and Compose setup for easy deployment.

Let me know which of the above you'd prefer next.
# Diabetes_ML
